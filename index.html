<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>fullofcoins</title>
        <link rel="icon" href="favicon.png" type="image/png" />
        <link rel="stylesheet" href="style.css?v=${Date.now()}" />
    </head>
    <body>
        <div class="layout-wrapper">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <h2>fullofcoins</h2>
                <ul>
                    <li>üè† Home</li>
                    <li>üìü Explore</li>
                    <li>üë§ Profile</li>
                    <li><button id="connectBtn">Connect Wallet</button></li>
                </ul>
                <div id="walletAddress" class="wallet-address"></div>
            </div>

            <div class="sidebar-overlay" id="sidebar-overlay"></div>

            <!-- Main Feed -->
            <div class="main-feed">
                <div class="feed-header">
                    <button id="menu-toggle-btn" class="menu-toggle">‚ò∞</button>
                    <h2>Decentralized Tweets</h2>
                    <button id="right-panel-toggle-btn" class="menu-toggle">
                        ‚ãÆ
                    </button>
                </div>

                <!-- New Posts Banner -->
                <div id="newPostsBanner" style="display: none">
                    <button id="showNewPostsBtn">Show new posts</button>
                </div>

                <!-- Tweet Composer -->
                <div
                    id="tweetComposer"
                    style="
                        padding: 10px 20px;
                        background: white;
                        border-bottom: 1px solid #ddd;
                    "
                >
                    <textarea
                        id="tweetInput"
                        rows="3"
                        placeholder="What's happening?"
                        style="width: 100%; padding: 10px; border-radius: 6px"
                    ></textarea>
                    <button
                        id="postTweetBtn"
                        style="
                            margin-top: 10px;
                            background: #1da1f2;
                            color: white;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 20px;
                            font-weight: bold;
                            cursor: pointer;
                        "
                    >
                        Tweet
                    </button>
                    <div
                        id="tweetMessage"
                        style="
                            margin-top: 6px;
                            min-height: 18px;
                            font-size: 0.9em;
                        "
                    ></div>
                </div>

                <div id="tweetList"><!-- Tweets will go here --></div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel" id="right-panel">
                <h3>Coming Soon</h3>
                <p>Analytics, Suggestions, or Ads</p>
            </div>
        </div>

        <!-- Wallet Modal -->
        <div id="walletModal" class="modal">
            <div class="modal-content">
                <h3>Connect Wallet</h3>
                <button id="metamaskBtn">ü¶Ñ Connect with MetaMask</button>
                <button id="closeModal" class="close-btn">Cancel</button>
            </div>
        </div>

        <div id="toast" class="toast"></div>

        <!-- Scripts -->
        <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
        <script src="app.js?v=${Date.now()}"></script>
        <script src="tweetPost.js?v=${Date.now()}"></script>
        <script src="tweetFetcher.js?v=${Date.now()}"></script>

        <script>
            window.chains = [
                {
                    rpcUrl: 'https://ethereum-sepolia.publicnode.com',
                    contractAddress:
                        '0xF9cF9c918b4DD16e5906FF70Ba58228E3d784736',
                    startBlock: 8594107,
                    chainId: 11155111,
                },
            ]

            window.addEventListener('DOMContentLoaded', () => {
                const ready = setInterval(() => {
                    if (window.tweetFetcher && window.ethers) {
                        clearInterval(ready)

                        const leftToggleBtn =
                            document.getElementById('menu-toggle-btn')
                        const rightToggleBtn = document.getElementById(
                            'right-panel-toggle-btn'
                        )
                        const leftPanel = document.getElementById('sidebar')
                        const rightPanel =
                            document.getElementById('right-panel')
                        const overlay =
                            document.getElementById('sidebar-overlay')
                        const walletModal =
                            document.getElementById('walletModal')
                        const connectBtn = document.getElementById('connectBtn')
                        const closeModal = document.getElementById('closeModal')

                        function closeAllPanels() {
                            leftPanel.classList.remove('is-open')
                            rightPanel.classList.remove('is-open')
                            document.body.classList.remove('menu-is-open')
                        }

                        if (leftToggleBtn) {
                            leftToggleBtn.addEventListener('click', e => {
                                e.stopPropagation()
                                const isOpen =
                                    leftPanel.classList.contains('is-open')
                                closeAllPanels()
                                if (!isOpen) {
                                    leftPanel.classList.add('is-open')
                                    document.body.classList.add('menu-is-open')
                                }
                            })
                        }

                        if (rightToggleBtn) {
                            rightToggleBtn.addEventListener('click', e => {
                                e.stopPropagation()
                                const isOpen =
                                    rightPanel.classList.contains('is-open')
                                closeAllPanels()
                                if (!isOpen) {
                                    rightPanel.classList.add('is-open')
                                    document.body.classList.add('menu-is-open')
                                }
                            })
                        }

                        if (overlay) {
                            overlay.addEventListener('click', closeAllPanels)
                        }

                        tweetFetcher.init()
                        tweetFetcher.loadCachedTweets()

                        ;(async () => {
                            await tweetFetcher.fetchAndUpdateTweets(
                                window.chains
                            )
                        })()

                        setInterval(
                            () =>
                                tweetFetcher.fetchAndUpdateTweets(
                                    window.chains
                                ),
                            60000
                        )
                    }
                }, 100)
            })
        </script>
    </body>
</html>
